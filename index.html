<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha RPG – Anime Medieval</title>
    <style>
        body{margin:0;font-family:Arial, sans-serif;background:#0d0b12;color:#eee; padding-bottom: 70px;}
        header{display:flex;gap:10px;padding:15px;background:#161222;border-bottom: 2px solid #3d2a5c;}
        header img{width:120px;height:160px;object-fit:cover;border-radius:10px;border:2px solid #3d2a5c;background:#000;cursor:pointer}
        .header-info{flex:1}
        .header-info input{width:100%;margin-bottom:6px;padding:8px;border-radius:6px;border:none;background:#1f1a2e;color:#fff;box-sizing:border-box}
        
        .tabs{display:flex;background:#161222;overflow-x: auto; position: sticky; top:0; z-index:10; border-bottom: 1px solid #3d2a5c;}
        .tabs button{flex:1;padding:15px;background:none;border:none;color:#aaa;font-size:11px;cursor:pointer;white-space: nowrap; text-transform: uppercase; font-weight: bold;}
        .tabs button.active{color:#fff;border-bottom:3px solid #7a4cff;background:#1f1a2e}
        
        .section{display:none;padding:15px;animation: fadeIn 0.3s;}
        .section.active{display:block}
        
        .bar-block{margin-bottom:15px; background: #161222; padding: 12px; border-radius: 8px; border: 1px solid #2a2438;}
        .bar-info{display:flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; font-size: 14px;}
        .bar{height:14px;background:#2a2438;border-radius:7px;overflow:hidden;margin: 8px 0; border: 1px solid #000;}
        .bar-fill{height:100%;width:0%;transition: width 0.4s cubic-bezier(0.17, 0.67, 0.83, 0.67);}
        
        #pvBar{background: linear-gradient(90deg, #8b0000, #ff4c4c);}
        #peBar{background: linear-gradient(90deg, #002db3, #4c7aff);}
        #arcBar{background: linear-gradient(90deg, #4b0082, #9370db);}
        #ocuBar{background: linear-gradient(90deg, #222, #555);}
        #vinBar{background: linear-gradient(90deg, #1d5c2d, #4cff77);}
        #corrBar{background: linear-gradient(90deg, #4a1d5c, #a34cff);}

        .bar-controls{display:flex; align-items: center; gap:8px; margin-top:10px; flex-wrap: wrap;}
        .bar-controls input { width: 60px; background: #0b090f; color: #fff; border: 1px solid #3d2a5c; border-radius: 4px; padding: 5px; }
        
        .input-group{margin-bottom: 15px; background: #161222; padding: 15px; border-radius: 8px;}
        .input-group label { display: block; margin-bottom: 8px; color: #7a4cff; font-weight: bold; font-size: 14px; }
        
        input, textarea, select { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #3d2a5c; background: #1f1a2e; color: #fff; box-sizing: border-box; margin-bottom: 10px; }
        
        button{background:#3d2a5c;color:#fff;border:none;border-radius:6px;padding:8px 12px;cursor:pointer; font-size: 14px;}
        button:hover{background:#7a4cff}
        
        .footer-tools{position: fixed; bottom: 0; width: 100%; background: #161222; padding: 10px; display: flex; justify-content: center; border-top: 1px solid #3d2a5c; z-index: 100;}
        .btn-undo{background: #5c5c2a; font-weight: bold; width: 80%;}

        .list-item{background:#1f1a2e;padding:12px;border-radius:6px;margin:8px 0;border-left:4px solid #7a4cff; overflow: hidden; position: relative;}
        .btn-delete{background: #8b0000; padding: 4px 8px; font-size: 11px; float: right; margin-left: 5px;}
        
        @keyframes fadeIn { from {opacity:0} to {opacity:1} }
    </style>
</head>
<body>

<header>
    <img id="imgChar" src="https://via.placeholder.com/120x160?text=Avatar" onclick="trocarImagem()">
    <div class="header-info">
        <input id="nome" placeholder="Nome" onchange="salvarHeader()">
        <input id="idade" placeholder="Idade" onchange="salvarHeader()">
        <input id="raca" placeholder="Raça" onchange="salvarHeader()">
        <input id="classe" placeholder="Classe" onchange="salvarHeader()">
    </div>
</header>

<div class="tabs">
    <button data-tab="0" class="tab-btn active">Status</button>
    <button data-tab="1" class="tab-btn">Atributos</button>
    <button data-tab="2" class="tab-btn">Poderes</button>
    <button data-tab="4" class="tab-btn">Equip</button>
    <button data-tab="6" class="tab-btn">Penitência</button>
    <button data-tab="7" class="tab-btn">Diário</button>
</div>

<div class="section active" data-sec="0">
    <div class="bar-block">
        <div class="bar-info"><span>Vida (PV)</span><span id="pvTxt">10 / 10</span></div>
        <div class="bar"><div id="pvBar" class="bar-fill"></div></div>
        <div class="bar-controls">
            <button onclick="alterarValor('pv', -1)">-1</button>
            <button onclick="alterarValor('pv', 1)">+1</button>
            <input type="number" id="pvMaxInput" onchange="setMax('pv')"><span>Máx</span>
        </div>
    </div>
    <div class="bar-block">
        <div class="bar-info"><span>Energia (PE)</span><span id="peTxt">10 / 10</span></div>
        <div class="bar"><div id="peBar" class="bar-fill"></div></div>
        <div class="bar-controls">
            <button onclick="alterarValor('pe', -1)">-1</button>
            <button onclick="alterarValor('pe', 1)">+1</button>
            <input type="number" id="peMaxInput" onchange="setMax('pe')"><span>Máx</span>
        </div>
    </div>
    <div class="bar-block">
        <div class="bar-info"><span>C. Arcano</span><span id="arcTxt">0 / 10</span></div>
        <div class="bar"><div id="arcBar" class="bar-fill"></div></div>
        <div class="bar-controls">
            <button onclick="alterarValor('arc', -1)">-1</button>
            <button onclick="alterarValor('arc', 1)">+1</button>
            <input type="number" id="arcMaxInput" onchange="setMax('arc')"><span>Máx</span>
        </div>
    </div>
    <div class="bar-block">
        <div class="bar-info"><span>Ocultismo</span><span id="ocuTxt">0 / 10</span></div>
        <div class="bar"><div id="ocuBar" class="bar-fill"></div></div>
        <div class="bar-controls">
            <button onclick="alterarValor('ocu', -1)">-1</button>
            <button onclick="alterarValor('ocu', 1)">+1</button>
            <input type="number" id="ocuMaxInput" onchange="setMax('ocu')"><span>Máx</span>
        </div>
    </div>
    <div class="bar-block">
        <div class="bar-info"><span>Vínculo</span><span id="vinTxt">0 / 10</span></div>
        <div class="bar"><div id="vinBar" class="bar-fill"></div></div>
        <div class="bar-controls">
            <button onclick="alterarValor('vin', -1)">-1</button>
            <button onclick="alterarValor('vin', 1)">+1</button>
            <input type="number" id="vinMaxInput" onchange="setMax('vin')"><span>Máx</span>
        </div>
    </div>
    <div class="bar-block">
        <div class="bar-info"><span>Corrupção</span><span id="corrTxt">0 / 10</span></div>
        <div class="bar"><div id="corrBar" class="bar-fill"></div></div>
        <div class="bar-controls">
            <button onclick="alterarValor('corr', -1)">-1</button>
            <button onclick="alterarValor('corr', 1)">+1</button>
            <input type="number" id="corrMaxInput" onchange="setMax('corr')"><span>Máx</span>
        </div>
    </div>
</div>

<div class="section" data-sec="1">
    <div class="input-group">
        <input id="attrNome" placeholder="Nome (ex: Força)">
        <input id="attrValor" type="number" placeholder="Valor">
        <button onclick="addAtributo()" style="width:100%">Adicionar Atributo</button>
    </div>
    <div id="listaAtributos"></div>
</div>

<div class="section" data-sec="2">
    <div class="input-group">
        <input id="habNome" placeholder="Nome do Poder">
        <textarea id="habDesc" placeholder="Descrição..."></textarea>
        <button onclick="addHabilidade()" style="width:100%">Adicionar Poder</button>
    </div>
    <div id="listaHabilidades"></div>
</div>

<div class="section" data-sec="4">
    <div class="input-group">
        <label>Defesa Atual</label>
        <input id="armDef" type="number" placeholder="Defesa Total" onchange="salvarSimples()">
    </div>
    <div class="input-group">
        <input id="armaNome" placeholder="Nome da Arma/Item">
        <input id="armaDano" placeholder="Dano / Efeito">
        <button onclick="addArma()" style="width:100%">Adicionar Item</button>
    </div>
    <div id="listaArmas"></div>
</div>

<div class="section" data-sec="6">
    <div class="input-group">
        <input id="penNome" placeholder="Nome da Penitência">
        <input id="penLV" type="number" placeholder="Nível">
        <textarea id="penDesc" placeholder="Descrição do fardo..."></textarea>
        <button onclick="addPenitencia()" style="width:100%">Adicionar Penitência</button>
    </div>
    <div id="listaPenitencias"></div>
</div>

<div class="section" data-sec="7">
    <div class="input-group">
        <label>História do Personagem</label>
        <textarea id="historia" style="height: 200px;" onchange="salvarSimples()" placeholder="Era uma vez..."></textarea>
    </div>
    <div class="input-group">
        <label>Anotações Gerais</label>
        <textarea id="notas" style="height: 200px;" onchange="salvarSimples()" placeholder="Missões, nomes de NPCs, etc..."></textarea>
    </div>
</div>

<div class="footer-tools">
    <button class="btn-undo" onclick="desfazer()">↩ DESFAZER ÚLTIMA AÇÃO</button>
</div>

<script>
let ficha = {
    nome: '', idade: '', raca: '', classe: '', img: '',
    pv: 10, pvMax: 10, pe: 10, peMax: 10, arc: 0, arcMax: 10, ocu: 0, ocuMax: 10, 
    vin: 0, vinMax: 10, corr: 0, corrMax: 10,
    atributos: {}, habilidades: [], armas: [], penitencias: [],
    defesa: 0, historia: '', notas: ''
};

let historico = [];

function snapshot() {
    if (historico.length > 20) historico.shift();
    historico.push(JSON.stringify(ficha));
}

function salvar(){ 
    localStorage.setItem('fichaRPG_V6', JSON.stringify(ficha)); 
    render();
}

function salvarSimples() {
    ficha.defesa = document.getElementById('armDef').value;
    ficha.historia = document.getElementById('historia').value;
    ficha.notas = document.getElementById('notas').value;
    salvar();
}

function salvarHeader() {
    ficha.nome = document.getElementById('nome').value;
    ficha.idade = document.getElementById('idade').value;
    ficha.raca = document.getElementById('raca').value;
    ficha.classe = document.getElementById('classe').value;
    salvar();
}

function desfazer() {
    if (historico.length > 0) {
        ficha = JSON.parse(historico.pop());
        salvar();
    } else {
        alert("Nada para desfazer.");
    }
}

function addAtributo() {
    const n = document.getElementById('attrNome').value.trim();
    const v = document.getElementById('attrValor').value;
    if(!n) return;
    if(ficha.atributos[n]) return alert("Este atributo já existe!");
    snapshot();
    ficha.atributos[n] = v;
    document.getElementById('attrNome').value = '';
    salvar();
}

function addHabilidade() {
    const n = document.getElementById('habNome').value.trim();
    const d = document.getElementById('habDesc').value;
    if(!n) return;
    if(ficha.habilidades.find(h => h.n.toLowerCase() === n.toLowerCase())) return alert("Poder com este nome já existe!");
    snapshot();
    ficha.habilidades.push({n, d});
    document.getElementById('habNome').value = ''; document.getElementById('habDesc').value = '';
    salvar();
}

function addPenitencia() {
    const n = document.getElementById('penNome').value.trim();
    const lv = document.getElementById('penLV').value;
    const d = document.getElementById('penDesc').value;
    if(!n) return;
    snapshot();
    ficha.penitencias.push({n, lv, d});
    document.getElementById('penNome').value = ''; document.getElementById('penDesc').value = '';
    salvar();
}

function addArma() {
    const n = document.getElementById('armaNome').value;
    const d = document.getElementById('armaDano').value;
    if(!n) return;
    snapshot();
    ficha.armas.push({n, d});
    document.getElementById('armaNome').value = ''; document.getElementById('armaDano').value = '';
    salvar();
}

function removerItem(chave, i) {
    snapshot();
    if(chave === 'atributos') delete ficha.atributos[i];
    else ficha[chave].splice(i, 1);
    salvar();
}

function editarGenerico(chave, i, campo) {
    snapshot();
    let novo;
    if(chave === 'atributos') {
        novo = prompt("Novo valor para " + i, ficha.atributos[i]);
        if(novo !== null) ficha.atributos[i] = novo;
    } else {
        novo = prompt("Editar:", ficha[chave][i][campo]);
        if(novo !== null) ficha[chave][i][campo] = novo;
    }
    salvar();
}

function render(){
    // Barras (Todas agora seguem o mesmo padrão)
    const barras = ['pv', 'pe', 'arc', 'ocu', 'vin', 'corr'];
    barras.forEach(b => {
        const perc = (ficha[b] / (ficha[b+'Max'] || 1)) * 100;
        document.getElementById(b+'Txt').textContent = `${ficha[b]} / ${ficha[b+'Max']}`;
        document.getElementById(b+'Bar').style.width = Math.min(100, Math.max(0, perc)) + '%';
        document.getElementById(b+'MaxInput').value = ficha[b+'Max'];
    });

    document.getElementById('nome').value = ficha.nome;
    document.getElementById('idade').value = ficha.idade;
    document.getElementById('raca').value = ficha.raca;
    document.getElementById('classe').value = ficha.classe;
    document.getElementById('armDef').value = ficha.defesa || 0;
    document.getElementById('historia').value = ficha.historia || '';
    document.getElementById('notas').value = ficha.notas || '';
    if(ficha.img) document.getElementById('imgChar').src = ficha.img;

    const renderLista = (id, lista, chave, htmlFunc) => {
        const el = document.getElementById(id);
        el.innerHTML = '';
        if(chave === 'atributos') {
            Object.keys(lista).forEach(k => el.innerHTML += htmlFunc(k, lista[k]));
        } else {
            lista.forEach((item, i) => el.innerHTML += htmlFunc(item, i));
        }
    };

    renderLista('listaAtributos', ficha.atributos, 'atributos', (k, v) => 
        `<div class="list-item"><span onclick="editarGenerico('atributos', '${k}')"><b>${k}:</b> ${v}</span><button class="
    
